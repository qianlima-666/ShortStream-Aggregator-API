# 更新日志（CHANGELOG）

## [Unreleased]

## [v4.2.0] - 2025-11-28
更新1：
 - 新增
   - 下载接口支持 Bilibili 音视频自动合并，保障下载视频带声音
   - 为关键路径增加统一指标日志（耗时、文件大小），便于后续监控接入
   - 并发速率限制中间件与 CORS 白名单配置，提升可控性与安全边界
 - 性能与稳定性
   - FFmpeg 合并改为异步子进程执行，并增加信号量并发限制，避免阻塞与资源争用
   - 流式下载优化连接池、超时与分块大小（64KB），完善断连与异常清理逻辑
   - 爬虫统一引入连接池 keepalive 与并发信号量限流，保持重试与超时策略一致
 - 安全
   - 下载路径与文件名清理和校验，防止路径穿越与非法字符写入
 - 配置
   - 统一从配置文件 `config.yaml` 读取运行参数（IP、端口、文档地址、认证、并发等）
   - 默认容器应用端口调整为 `3000`，健康检查同步到 `/docs`
 - 工程化
   - 引入 `pytest` 与覆盖率配置，新增文档端点可用性测试
   - 集成 `ruff/black/isort` 与 `pre-commit`，统一代码风格与静态检查
   - 迁移至 `pyproject.toml` 管理依赖并锁定关键版本（如 `numpy`、`tenacity`）
 - 容器与运行
   - `Dockerfile` 多阶段构建，添加非 root 用户与健康检查；基础代码加固（编译为 `.pyc` 并优先运行字节码）
   - 启动脚本 `start.sh` 支持优先运行字节码，开发环境仍可运行源码
 - 文档
   - 增加 README 英文版说明，完善项目介绍与使用指引
更新2：
- 性能：Bilibili 音视频合并改为异步子进程并发受限，避免阻塞。
- 下载：优化流式下载的连接池、超时与分块策略，完善断连与异常清理。
- 爬虫：统一并发信号量限流与连接池 keepalive，保留重试与超时策略。
- 安全：下载文件名与路径清理/校验，防止路径穿越与非法字符。
- 中间件：新增并发速率限制与 CORS 白名单，读取自配置与 ENV 覆盖。
- 配置：支持 ENV 覆盖 Host/Docs/认证/并发/下载路径，区分开发与生产。
- 观测：增加统一指标日志（耗时/大小）埋点，便于监控接入。
- 测试：引入 pytest 与覆盖率配置，新增文档端点可用性测试。
- 规范：集成 ruff/black/isort 与 pre-commit，统一代码风格与静态检查。
- 依赖：新增 pyproject.toml，锁定 numpy 与 tenacity 版本范围。
- 容器：Dockerfile 多阶段构建、非 root 用户与健康检查；启动参数可配置 reload/workers。
- 端口：Docker 使用应用端口 `3000`，健康检查同步调整。

## 2025-11-28 (c70257e499ea0261fbf24a77bfbfcbeaf06d2efc)
 - 新增
   - 下载接口支持 Bilibili 音视频自动合并，保障下载视频带声音
   - 为关键路径增加统一指标日志（耗时、文件大小），便于后续监控接入
   - 并发速率限制中间件与 CORS 白名单配置，提升可控性与安全边界
 - 性能与稳定性
   - FFmpeg 合并改为异步子进程执行，并增加信号量并发限制，避免阻塞与资源争用
   - 流式下载优化连接池、超时与分块大小（64KB），完善断连与异常清理逻辑
   - 爬虫统一引入连接池 keepalive 与并发信号量限流，保持重试与超时策略一致
 - 安全
   - 下载路径与文件名清理和校验，防止路径穿越与非法字符写入
 - 配置
   - 统一从配置文件 `config.yaml` 读取运行参数（IP、端口、文档地址、认证、并发等）
   - 默认容器应用端口调整为 `3000`，健康检查同步到 `/docs`
 - 工程化
   - 引入 `pytest` 与覆盖率配置，新增文档端点可用性测试
   - 集成 `ruff/black/isort` 与 `pre-commit`，统一代码风格与静态检查
   - 迁移至 `pyproject.toml` 管理依赖并锁定关键版本（如 `numpy`、`tenacity`）
 - 容器与运行
   - `Dockerfile` 多阶段构建，添加非 root 用户与健康检查；基础代码加固（编译为 `.pyc` 并优先运行字节码）
   - 启动脚本 `start.sh` 支持优先运行字节码，开发环境仍可运行源码
 - 文档
   - 增加 README 英文版说明，完善项目介绍与使用指引
