# 更新日志（CHANGELOG）

## [Unreleased]
更新内容：

## [v4.2.0] - 2025-11-28
更新内容：
 - 新增
   - 下载接口支持 Bilibili 音视频自动合并，保障下载视频带声音
   - 为关键路径增加统一指标日志（耗时、文件大小），便于后续监控接入
   - 并发速率限制中间件与 CORS 白名单配置，提升可控性与安全边界
   - 新增 `/health` 健康检查端点，返回运行状态与版本信息
   - 添加健康检查单元测试 `tests/test_health.py`

 - 更改
   - 容器健康检查改为探测 `/health`
   - 移除 `SSA_*` 环境变量，运行参数统一从 `config.yaml` 读取

 - 性能与稳定性
   - FFmpeg 合并改为异步子进程执行，并增加信号量并发限制，避免阻塞与资源争用
   - 流式下载优化连接池、超时与分块大小（64KB），完善断连与异常清理逻辑
   - 爬虫统一引入连接池 keepalive 与并发信号量限流，保持重试与超时策略一致
 - 安全
   - 下载路径与文件名清理和校验，防止路径穿越与非法字符写入
 - 配置
   - 统一从配置文件 `config.yaml` 读取运行参数（IP、端口、文档地址、认证、并发等）
  - 默认容器应用端口调整为 `3000`
 - 工程化
   - 引入 `pytest` 与覆盖率配置，新增文档端点可用性测试
   - 集成 `ruff/black/isort` 与 `pre-commit`，统一代码风格与静态检查
   - 迁移至 `pyproject.toml` 管理依赖并锁定关键版本（如 `numpy`、`tenacity`）
 - 容器与运行
   - `Dockerfile` 多阶段构建，添加非 root 用户与健康检查；基础代码加固（编译为 `.pyc` 并优先运行字节码）
   - 启动脚本 `start.sh` 支持优先运行字节码，开发环境仍可运行源码
 - 文档
   - 增加 README 英文版说明，完善项目介绍与使用指引
（以下为简版汇总保留于 Unreleased）
- 性能：Bilibili 音视频合并改为异步子进程并发受限，避免阻塞。
- 下载：优化流式下载的连接池、超时与分块策略，完善断连与异常清理。
- 爬虫：统一并发信号量限流与连接池 keepalive，保留重试与超时策略。
- 安全：下载文件名与路径清理/校验，防止路径穿越与非法字符。
- 中间件：新增并发速率限制与 CORS 白名单，读取自配置。
- 配置：统一从配置文件读取；默认端口为 `3000`。
- 观测：增加统一指标日志（耗时/大小）。
- 测试：引入 pytest 与覆盖率配置。
- 规范：集成 ruff/black/isort 与 pre-commit。
- 依赖：新增 pyproject.toml 并锁定关键版本。
- 容器：多阶段构建、非 root 与健康检查。
